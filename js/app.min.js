"use strict";var UTIL=function(){let e={capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},round:function(e){return Math.round(100*(e+Number.EPSILON))/100},guid:function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}};return e}(),LANG=function(){let e={data:null,_current:null,keys:["es","bu","de","en","fr","gr","hu","it","nl","pt","ro","ru","tr"]};const t="eurospandLang";return e.init=function(n){let i={lang:null};n=Object.assign({},i,n);let c=document.querySelector("[data-lang]");if(c&&c.remove(),!n.lang){let e=localStorage.getItem(t);e&&(n.lang=e)}n.lang||(n.lang=LANG.detect()),n.lang||(n.lang="en");let a="lang/"+n.lang+".js",r=document.createElement("script");r.setAttribute("data-lang",n.lang),r.onload=function(){e.data=LANG_DATA,APP.init()},r.src=a,document.head.appendChild(r),e._current=n.lang,localStorage.setItem(t,e.current())},e.current=function(){return e._current},e.get=function(t){return e.data[t]},e.list=function(){return[{id:"bu",name:"bu"},{id:"de",name:"de"},{id:"en",name:"en"},{id:"es",name:"es"},{id:"fr",name:"fr"},{id:"gr",name:"gr"},{id:"hu",name:"hu"},{id:"it",name:"it"},{id:"nl",name:"nl"},{id:"pt",name:"pt"},{id:"ro",name:"ro"},{id:"ru",name:"ru"},{id:"tr",name:"tr"}]},e.change=function(t){e.init({lang:t})},e.detect=function(){let e=null;try{e=navigator.language.substring(0,2)}catch(t){e=null}return e},e}(),API=function(){let e={};return e=function(e,t){function n(e){return new Promise(t=>e.json().then(n=>t({status:e.status,ok:e.ok,json:n})))}let i,c=!1;if(t instanceof FormData)i=t;else{c=!0;let e={};t=Object.assign({},e,t),i=JSON.stringify(t)}let a={method:"post",body:i};return c&&(a.headers={"content-type":"application/json"}),new Promise((t,i)=>{fetch(e,a).then(e=>(e.redirected&&(location.href=e.url),e)).then(n).then(e=>e.ok?t(e.json.content):i(e.json)).catch(e=>i({networkError:e.message}))})},e}(),APP=function(){let e={debug:!1,currentMachine:null,currentConcime:null,concimeTypeList:["fertilizzanti","semi","lumachicida"]};const t="eurospandSavedWorks";let n,i,c,a,r;return e.init=function(){n=document.querySelector("body"),i=document.querySelector(".main"),c=document.querySelector(".menu"),a=document.querySelector(".title .red"),r=document.querySelector(".title .gray"),e.debug&&(e.currentMachine="david-compact",e.currentConcime="mesurol-pro",e.currentWorkingWidth=9,e.currentWorkingSpeed=6,e.currentWorkingQuantity=1),e.routes=[{regex:"^$",template:"index",callback:e.initIndex},{regex:"^set-machine/?$",template:"set-machine",callback:e.initSetMachine},{regex:"^machine/(?<id>[^/]*)/?$",template:"machine-detail",callback:e.initMachine,animate:!1},{regex:"^set-concime/?$",template:"set-concime",callback:e.initSetConcime},{regex:"^set-params/?$",template:"set-params",callback:e.initSetWorkingParameters},{regex:"^result/?$",template:"result",callback:e.initResult},{regex:"^flow-factor/?$",template:"flow-factor",callback:e.initFlowFactor},{regex:"^saved-works/?$",template:"saved-works",callback:e.initSavedWorks},{regex:"^set-language/?$",template:"set-language",callback:e.initSetLanguage}],window.addEventListener("hashchange",APP.onHashChange,!1),APP.onHashChange(),e.initMenu()},e.onHashChange=function(){e.hash=location.hash.substring(1);let t=!0,n=200;for(const a of e.routes){let r=new RegExp(a.regex,"i"),s=e.hash.match(r);if(s){let r=s.groups,o=document.querySelector(`template[data-section=${a.template}]`);if(o){e.currentTemplate&&(e.previousTemplate=e.currentTemplate),e.currentTemplate=a.template,e.currentTemplate;let s=o.content.cloneNode(!0);function c(){function e(){document.body.classList.add("animate")}let c=null;c="function"==typeof a.callback?a.callback(s,r):s,c&&(i.innerHTML="",i.append(c)),t?window.setTimeout(function(){e()},n):e()}t&&(document.body.classList.remove("animate"),e.previousTemplate?setTimeout(function(){c()},n):c())}break}}},e.changeContent=function(e){location.hash=e},e.initIndex=function(e){return i.innerHTML="",i.append(e),null},e.setTitle=function(e,t){a&&(a.innerHTML=e),r&&t&&(r.innerHTML=t)},e.initMenu=function(){let e=c.querySelector(".menu-saved"),t=c.querySelector(".menu-lang"),n=c.querySelector(".menu-unit"),i=c.querySelector(".menu-who"),a=c.querySelector(".menu-contact");e.innerHTML=LANG.get("menu-saved"),t.innerHTML=LANG.get("menu-lang"),n.innerHTML=LANG.get("menu-unit"),i.innerHTML=LANG.get("menu-who"),a.innerHTML=LANG.get("menu-contact")},e.menuOpen=function(){c.classList.add("is-visible"),n.classList.add("is-overflow")},e.menuClose=function(){c.classList.remove("is-visible"),n.classList.remove("is-overflow")},e.initSetLanguage=function(){let t="",n=document.createElement("div");e.getSavedWorks();for(const e of LANG.list())t+=`\n                <div class="lang">\n                    <div class="lang-title" onclick="LANG.change('${e.id}');">\n                        <div class="lang-flag"><img src="img/lang/flag-${e.id}.png" /></div>\n                        <div class="lang-title">${e.name}</div>\n                    </div>\n                </div>`;return t=`<div class="lang-list">${t}</div>`,n.innerHTML=t,n},e.getStepHtml=function(t){let n=document.createElement("div");n.classList.add("step-list");let i="Calculate opening",c=LANG.get("step-description-"+t),a=`<div class="title">\n            <div class="red">\n                <span>${i}</span>\n            </div>\n\n            <div class="gray" onclick="APP.hideConcime();">\n                ${c}\n            </div>\n        </div>`;a+=`<div class="step-list">\n            <button class="step" data-step="machine" onclick="APP.changeContent('set-machine');">\n                <div class="step-number">1</div>\n                <div class="step-title">${LANG.get("step-machine")}</div>\n                <div class="step-img">\n                    <img src="img/icons/funnel${"machine"===t?"-white":""}.svg" />\n                </div>\n                <div class="step-subtitle">Set your spreader</div>\n            </button>\n            <button class="step" data-step="concime" onclick="APP.changeContent('set-concime');">\n                <div class="step-number">2</div>\n                <div class="step-title">${LANG.get("step-concime")}</div>\n                <div class="step-img">\n                    <img src="img/icons/flower${"concime"===t?"-white":""}.svg" />\n                </div>\n                <div class="step-subtitle">Set the product</div>\n            </button>\n            <button class="step" data-step="params" onclick="APP.changeContent('set-params');">\n                <div class="step-number">3</div>\n                <div class="step-title">${LANG.get("step-params")}</div>\n                <div class="step-img">\n                    <img src="img/icons/slider${"params"===t?"-white":""}.svg" />\n                </div>\n                <div class="step-subtitle">Set working parameters</div>\n            </button>\n            <button class="step" data-step="result" onclick="APP.changeContent('result');">\n                <div class="step-number">4</div>\n                <div class="step-title">RESULT</div>\n                <div class="step-img">\n                    <img src="img/icons/list-result${"result"===t?"-white":""}.svg" />\n                </div>\n                <div class="step-subtitle">Result</div>\n            </button>\n        </div>`,n.innerHTML=a;let r=n.querySelector(`[data-step=${t}]`);r.classList.add("is-selected");let s=!e.currentConcime||!e.currentMachine,o=n.querySelector("[data-step=params]"),l=n.querySelector("[data-step=result]");if(s?(o.classList.add("is-disabled"),l.classList.add("is-disabled")):(o.classList.remove("is-disabled"),l.classList.remove("is-disabled")),e.currentMachine){let t=n.querySelector("[data-step=machine]");t.classList.add("is-set");let i=n.querySelector("[data-step=machine] .step-subtitle");i.innerHTML=e.getMachine(e.currentMachine).name}if(e.currentConcime){let t=n.querySelector("[data-step=concime]");t.classList.add("is-set");let i=n.querySelector("[data-step=concime] .step-subtitle");i.innerHTML=e.getConcime(e.currentConcime).name}if(e.currentWorkingWidth&&e.currentWorkingSpeed&&e.currentWorkingQuantity){let e=n.querySelector("[data-step=params]");e.classList.add("is-set")}return n.innerHTML},e.initSetMachine=function(t){let n=t.querySelector(".machine-list"),c=e.getMachine(),a="";for(const e of Object.keys(c)){let t=c[e];a+=`<button class="machine" onclick="APP.setMachine('${e}');">\n                <div class="machine-img">\n                    <img src="img/machine/${e}.jpg" alt="${t.name}" />\n                </div>\n                <div class="machine-footer">\n\n                    <div class="machine-info" onclick="event.stopPropagation();APP.showMachine('${e}');">\n                        <img src="img/icons/info-white.svg" />\n                    </div>\n                        <div class="machine-title">\n                            <div>\n                            ${t.name}\n                            <small>${t.subtitle}</small>\n                            </div>\n                        <img src="img/icons/chevron-right-white.svg" />\n                    </div>\n                </div>\n            </button>`}return e.setTitle("Calculate opening",LANG.get("step-description-machine")),n.innerHTML=a,i.innerHTML=e.getStepHtml("machine"),i.append(t),null},e.getMachine=function(e){return e?MACHINE_DATA[e]:MACHINE_DATA},e.setMachine=function(t){t&&(e.currentMachine=t,e.refreshStepList(),e.currentConcime?e.changeContent("set-params"):e.changeContent("set-concime"))},e.initMachine=function(t,n){let c=e.getMachine(n.id),a="machine-desc",r=`<div class="machine-detail">\n            <button class="machine-close" onclick="APP.hideMachine();">\n                <img src="img/icons/close.svg" alt="">\n            </button>\n            <div class="machine-img">\n                <img src="img/machine/${n.id}.jpg" alt="${c.name}" />\n            </div>\n            <div class="machine-title">\n                ${c.name}\n            </div>\n            <div class="machine-subtitle">\n                ${c.subtitle}\n                </div>\n            <div class="machine-desc">${a}</div>\n        </div>`,s=document.createElement("div");return s.classList.add("machine-detail-container","is-visible"),s.innerHTML=r,i.append(s),null},e.showMachine=function(t){let n=e.getMachine(t),c=LANG.get(t),a=`<div class="machine-detail">\n            <div class="machine-title">\n                ${n.name}\n                <small>${n.subtitle}</small>\n\n                <button class="machine-close" onclick="APP.hideMachine();">\n                    <img src="img/icons/close-white.svg" alt="">\n                </button>\n            </div>\n            <div class="machine-scroll">\n                <div class="machine-img">\n                    <img src="img/machine/${t}.jpg" alt="${n.name}" />\n                    <div class="machine-subtitle">\n                        ${c.subtitle}\n                    </div>\n                </div>\n\n                <div class="machine-desc">\n                    <b>${c.shortDescription}</b>\n                    ${c.description}\n                </div>\n            </div>\n        </div>`,r=document.createElement("div");return r.classList.add("machine-detail-container"),r.innerHTML=a,i.append(r),setTimeout(()=>{document.querySelector(".machine-detail-container").classList.add("is-visible")},300),null},e.hideMachine=function(){e.previousTemplate;let t=document.querySelector(".machine-detail-container");t&&(t.classList.remove("is-visible"),setTimeout(()=>{t.remove()},300))},e.initSetConcime=function(t){let n=t.querySelector(".concime-type-list"),c=t.querySelector(".concime-list"),a=e.getConcime(),r='<div class="concime-type-title">Filter by:</div>';for(const t of e.concimeTypeList){let e=UTIL.capitalizeFirstLetter(t);r+=`<button class="concime-type" onclick="APP.setConcimeType(this, '${t}');">\n                <div class="concime-type-img">\n                    <img src="img/concime-type/${t}.jpg" alt="${e}" />\n                </div>\n                ${e}\n            </button>`}n.innerHTML=r,r="";for(const e of Object.keys(a)){let t=a[e];r+=`<button class="concime" data-concime-type="${t.type}" onclick="APP.setConcime('${e}');">\n                <div class="concime-img">\n                    <img src="img/concime/${e}.png" alt="${t.name}" />\n                </div>\n                <div class="concime-footer">\n                    <div class="concime-info" onclick="event.stopPropagation();APP.showConcime('${e}');">\n                        <img src="img/icons/info-white.svg" />\n                    </div>\n                    <div class="concime-title">\n                        <div>${t.name}</div>\n                        <img src="img/icons/chevron-right-white.svg" />\n                    </div>\n                </div>\n            </button>`}return c.innerHTML=r,i.innerHTML=e.getStepHtml("concime"),i.append(t),e.setTitle("Calculate opening",LANG.get("step-description-concime")),null},e.getConcime=function(e){return e?CONCIME_DATA[e]:CONCIME_DATA},e.setConcimeType=function(e,t){let n=document.querySelector(".concime-type.is-selected");if(n&&n.classList.remove("is-selected"),e.classList.add("is-selected"),!t)return;let i=document.querySelectorAll(".concime");for(const e of i)e.getAttribute("data-concime-type")===t?e.removeAttribute("hidden"):e.setAttribute("hidden","")},e.setConcime=function(t){t&&(e.currentConcime=t,e.refreshStepList(),e.changeContent("set-params"),e.currentMachine?e.changeContent("set-params"):e.changeContent("set-machine"))},e.refreshStepList=function(){if(e.currentConcime&&e.currentMachine){let e=document.querySelector(".step[data-step=params]");e.classList.remove("is-disabled")}},e.showConcime=function(t){let n=e.getConcime(t),c=(LANG.get(t),[{category:"Information"},{name:"Family",value:n.category||""},{name:"Country",value:n.country||""},{name:"Form",value:n.producer||""},{name:"Manufacturer",value:n.producer||""},{name:"KG/DM3",value:n.weight||""},{category:"Fractionation"},{name:"",value:""},{name:"",value:""},{category:"Chemical composition"},{name:"",value:n.chemicalComposition_it||""}]),a="";for(const e of c)e.category?a+=`<div class="property-category">${e.category}</div>`:e.value&&(a+=`<div class="property">\n                    <div class="property-name">${e.name}</div>\n                    <div class="property-line"></div>\n                    <div class="property-value">${e.value}</div>\n                </div>`);let r=`<div class="concime-detail">\n            <div class="concime-title">\n                <small>${n.type}</small>\n\n                <button class="concime-close" onclick="APP.hideConcime();">\n                    <img src="img/icons/close-white.svg" alt="">\n                </button>\n            </div>\n            <div class="concime-scroll">\n                <div class="concime-img">\n                    <img src="img/concime/${t}.png" alt="${n.name}" />\n                    <div class="concime-subtitle">\n                        ${n.name}\n                    </div>\n                </div>\n\n                <div class="property-list">\n                    ${a}\n                </div>\n            </div>\n        </div>`,s=document.createElement("div");return s.classList.add("concime-detail-container"),s.innerHTML=r,i.append(s),setTimeout(()=>{document.querySelector(".concime-detail-container").classList.add("is-visible")},300),null},e.hideConcime=function(){e.previousTemplate;let t=document.querySelector(".concime-detail-container");t&&(t.classList.remove("is-visible"),setTimeout(()=>{t.remove()},300))},e.initSetWorkingParameters=function(t){e.currentMachine||e.changeContent("set-machine"),e.currentConcime||e.changeContent("set-concime");let n=e.getMachine(e.currentMachine),c="";n.widthOpt&&(c=`<div class="optional-width">\n                <input class="optional-width-checkbox switch" id="optionalWidth" name="optionalWidth" type="checkbox" onchange="APP.refreshMaxWorkingWidth();">\n                <label class="optional-width-label" for="optionalWidth">${LANG.get("working-optional-kit")}</label>\n            </div>`);let a={width:{min:n.widthMin,max:e.getMaxWidth(e.currentMachine,e.currentConcime),unit:"m",current:e.currentWorkingWidth},speed:{min:6,max:20,unit:"km/h",current:e.currentWorkingSpeed},quantity:{min:3,max:1e3,unit:"kg/ha",current:e.currentWorkingQuantity}},r=t.querySelector(".parameter-list"),s="";for(const e of Object.keys(a)){let t=a[e],n=t.current||t.min;s+=`<div class="parameter parameter-${e}" data-id="${e}">\n                <div class="parameter-title">${UTIL.capitalizeFirstLetter(e)}</div>\n                ${"width"===e?c:""}\n                <div class="parameter-input">\n                    <div class="parameter-text">\n                        <input id="widthText" type="text" value="${n}" onchange="APP.refreshCurrentParams(this);">\n                    </div>\n                    <div class="parameter-slider">\n                        <div class="parameter-max">${t.max} ${t.unit}</div>\n                        <div class="parameter-min">${t.min} ${t.unit}</div>\n                        <input id="widthRange" type="range" step="1" max="${t.max}" min="${t.min}" value="${n}" oninput="APP.refreshCheckLabel(this);">\n                    </div>\n                </div>\n\n\n            </div>`}return r.innerHTML=s,i.innerHTML=e.getStepHtml("params"),t.innerHTML=s,i.append(t),e.setTitle("Calculate opening",LANG.get("step-description-params")),null},e.refreshCheckLabel=function(t){let n=t.closest(".parameter"),i=n.querySelector(".parameter-text input"),c=UTIL.capitalizeFirstLetter(n.getAttribute("data-id"));e["currentWorking"+c]=t.value,i.value=t.value},e.refreshMaxWorkingWidth=function(){e.getMachine(e.currentMachine);let t=document.querySelector(".optional-width-checkbox"),n=document.querySelector(".parameter-width .parameter-max"),i=document.querySelector(".parameter-width .parameter-slider input"),c=e.getMaxWidth(e.currentMachine,e.currentConcime,t.checked);n.innerHTML=c+"m",i.setAttribute("max",c),e.refreshCheckLabel(i)},e.paramsReset=function(){},e.refreshCurrentParams=function(t){let n=t.closest(".parameter"),i=UTIL.capitalizeFirstLetter(n.getAttribute("data-id"));e["currentWorking"+i]=t.value},e.paramsCompute=function(){e.changeContent("result")},e.getMaxWidth=function(t,n,i=!1){let c=e.getMachine(t),a=e.getConcime(n),r=Math.min(c.widthMax,a.spreadingLimit),s=i?c.widthOptException:c.widthException;return s&&n in s&&(r=Math.min(r,s[n])),r},e.getOpening=function(t,n){const i=0,c=1;e.getMachine(t),e.getConcime(n);let a=e.currentWorkingQuantity*e.currentWorkingWidth*e.currentWorkingSpeed/600;a=UTIL.round(a);let r=null,s=CURVE_DATA[n],o=Number.MAX_VALUE,l=null;for(let e=0;e<s.length&&(l=Math.abs(s[e][c]-a),l<o);e++)o=l,r=s[e][i];return{opening:r,kgMin:a}},e.initResult=function(t){function n(e,t,n=!1){let i="opening"===e.toLowerCase(),c="";return c+=n?`<div class="property-category">${e}</div>`:`<div class="property ${i?"is-important":""}">\n                    <div class="property-name">${e}</div>\n                    <div class="property-line"></div>\n                    <div class="property-value">${t}</div>\n                </div>`,c}e.currentMachine||e.changeContent("set-machine"),e.currentConcime||e.changeContent("set-concime");let c=e.getMachine(e.currentMachine),a=e.getConcime(e.currentConcime),r=t.querySelector(".result-list"),s="",o=e.getOpening(e.currentMachine,e.currentConcime);return s+=n("Result",c.name,!0),s+=n("Opening",o.opening),s+=n("Kg/min",o.kgMin),s+=n("Spreader",c.name,!0),s+=n("Spreader",c.name),s+=n("Discs height",""),s+=n("Pto speed",""),s+=n("Concime",c.name,!0),s+=n("Family",a.type),s+=n("Product",a.name),s+=n("Form",a.shape),s+=n("Weight",a.weight),s+=n("Working parameters",c.name,!0),s+=n("Working width",e.currentWorkingWidth),s+=n("Speed",e.currentWorkingSpeed),s+=n("Quantity",e.currentWorkingQuantity),r.innerHTML='<div class="property-list">'+s+"</div>",i.innerHTML=e.getStepHtml("result"),i.append(t),null},e.saveResult=function(){let n={currentMachine:e.currentMachine,currentConcime:e.currentConcime,currentWorkingWidth:e.currentWorkingWidth,currentWorkingSpeed:e.currentWorkingSpeed,currentWorkingQuantity:e.currentWorkingQuantity,date:(new Date).toISOString(),id:UTIL.guid()},i=e.getSavedWorks();i.unshift(n),localStorage.setItem(t,JSON.stringify(i)),e.changeContent("saved-works")},e.getSavedWorks=function(){let e=JSON.parse(localStorage.getItem(t));return Array.isArray(e)||(e=[]),e},e.initSavedWorks=function(){let t="",n=document.createElement("div"),i=e.getSavedWorks();for(const e of i){let n=encodeURIComponent(JSON.stringify(e));t+=`\n                <div class="saved-work">\n                    <div class="saved-work-title" onclick="APP.loadSavedWork('${n}');">${e.date}</div>\n                    <div class="saved-work-subtitle">${e.date}</div>\n                    <div class="saved-work-delete" onclick="APP.deleteSavedWork('${e.id||0}');">X</div>\n                </div>`}return t=`<div class="saved-work-list">${t}</div>`,n.innerHTML=t,n},e.loadSavedWork=function(t){t=JSON.parse(decodeURIComponent(t)),e.currentMachine=t.currentMachine,e.currentConcime=t.currentConcime,e.currentWorkingWidth=t.currentWorkingWidth,e.currentWorkingSpeed=t.currentWorkingSpeed,e.currentWorkingQuantity=t.currentWorkingQuantity,e.changeContent("result")},e.deleteSavedWork=function(n){let i=e.getSavedWorks(),c=0;for(const e of i){if(e.id==n){i.splice(c,1);break}c++}localStorage.setItem(t,JSON.stringify(i)),location.reload()},e.getFlowStepHtml=function(t){let n="",i="is-selected",c=!e.currentConcime||!e.currentMachine;return n=`<div class="step-list">\n            <button class="step ${"machine"===t?i:""}" data-step="machine" onclick="APP.changeContent('set-machine');">\n                <div class="step-number">1</div>\n                <div class="step-title">${LANG.get("step-machine")}</div>\n                <div class="step-subtitle">Set your spreader</div>\n            </button>\n            <button class="step ${c?"is-disabled":""} ${"params"===t?i:""}" data-step="params" onclick="APP.changeContent('set-params');">\n                <div class="step-number">2</div>\n                <div class="step-title">${LANG.get("step-params")}</div>\n                <div class="step-subtitle">Set parameters</div>\n            </button>\n            <button class="step ${c?"is-disabled":""} ${"result"===t?i:""}" data-step="result" onclick="APP.changeContent('result');">\n                <div class="step-number">3</div>\n                <div class="step-title">RESULT</div>\n                <div class="step-subtitle"> </div>\n            </button>\n        </div>`,n},e.initFlowFactor=function(t){return i.innerHTML=e.getFlowStepHtml("machine"),i.append(t),null},e}();document.addEventListener("DOMContentLoaded",function(){LANG.init()});