"use strict";var UTIL=function(){let e={capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},round:function(e){return Math.round(100*(e+Number.EPSILON))/100}};return e}(),LANG=function(){let e={data:null,_current:null,keys:["es","bu","de","en","fr","gr","hu","it","nl","pt","ro","ru","tr"],init:function(t){let n={lang:"en"};t=Object.assign({},n,t);let i="/lang/"+t.lang+".js",c=document.createElement("script");c.onload=function(){e.data=LANG_DATA,APP.init()},c.src=i,document.head.appendChild(c),e._current=t.lang},current:function(){return e._current},get:function(t){return e.data[t]}};return e}(),API=function(){let e={};return e=function(e,t){function n(e){return new Promise(t=>e.json().then(n=>t({status:e.status,ok:e.ok,json:n})))}let i,c=!1;if(t instanceof FormData)i=t;else{c=!0;let e={};t=Object.assign({},e,t),i=JSON.stringify(t)}let a={method:"post",body:i};return c&&(a.headers={"content-type":"application/json"}),new Promise((t,i)=>{fetch(e,a).then(e=>(e.redirected&&(location.href=e.url),e)).then(n).then(e=>e.ok?t(e.json.content):i(e.json)).catch(e=>i({networkError:e.message}))})},e}(),APP=function(){let e,t,n,i,c,a={debug:!1,currentMachine:null,currentConcime:null,concimeTypeList:["fertilizzanti","semi","lumachicida"]};return a.init=function(){e=document.querySelector("body"),t=document.querySelector(".main"),n=document.querySelector(".menu"),i=document.querySelector(".title .red"),c=document.querySelector(".title .gray"),a.debug&&(a.currentMachine="david-compact",a.currentConcime="mesurol-pro",a.currentWorkingWidth=9,a.currentWorkingSpeed=6,a.currentWorkingQuantity=1),a.routes=[{regex:"^$",template:"index",callback:a.initIndex},{regex:"^set-machine/?$",template:"set-machine",callback:a.initSetMachine},{regex:"^machine/(?<id>[^/]*)/?$",template:"machine-detail",callback:a.initMachine,animate:!1},{regex:"^set-concime/?$",template:"set-concime",callback:a.initSetConcime},{regex:"^set-params/?$",template:"set-params",callback:a.initSetWorkingParameters},{regex:"^result/?$",template:"result",callback:a.initResult},{regex:"^flow-factor/?$",template:"flow-factor",callback:a.initFlowFactor}],window.addEventListener("hashchange",APP.onHashChange,!1),APP.onHashChange(),a.initMenu()},a.onHashChange=function(){a.hash=location.hash.substring(1);let e=!0,n=200;for(const c of a.routes){let s=new RegExp(c.regex,"i"),r=a.hash.match(s);if(r){let s=r.groups,o=document.querySelector(`template[data-section=${c.template}]`);if(o){a.currentTemplate&&(a.previousTemplate=a.currentTemplate),a.currentTemplate=c.template,a.currentTemplate;let r=o.content.cloneNode(!0);function i(){function i(){document.body.classList.add("animate")}let a=null;a="function"==typeof c.callback?c.callback(r,s):r,a&&(t.innerHTML="",t.append(a)),e?window.setTimeout(function(){i()},n):i()}e&&(document.body.classList.remove("animate"),a.previousTemplate?setTimeout(function(){i()},n):i())}break}}},a.changeContent=function(e){location.hash=e},a.initIndex=function(e){return t.innerHTML="",t.append(e),null},a.setTitle=function(e,t){i&&(i.innerHTML=e),c&&t&&(c.innerHTML=t)},a.initMenu=function(){let e=n.querySelector(".menu-saved"),t=n.querySelector(".menu-lang"),i=n.querySelector(".menu-unit"),c=n.querySelector(".menu-who"),a=n.querySelector(".menu-contact");e.innerHTML=LANG.get("menu-saved"),t.innerHTML=LANG.get("menu-lang"),i.innerHTML=LANG.get("menu-unit"),c.innerHTML=LANG.get("menu-who"),a.innerHTML=LANG.get("menu-contact")},a.menuOpen=function(){n.classList.add("is-visible"),e.classList.add("is-overflow")},a.menuClose=function(){n.classList.remove("is-visible"),e.classList.remove("is-overflow")},a.getStepHtml=function(e){let t=document.createElement("div");t.classList.add("step-list");let n="Calculate opening",i=LANG.get("step-description-"+e),c=`<div class="title">\n            <div class="red">\n                <span>${n}</span>\n            </div>\n\n            <div class="gray" onclick="APP.hideConcime();">\n                ${i}\n            </div>\n        </div>`;c+=`<div class="step-list">\n            <button class="step" data-step="machine" onclick="APP.changeContent('set-machine');">\n                <div class="step-number">1</div>\n                <div class="step-title">${LANG.get("step-machine")}</div>\n                <div class="step-img">\n                    <img src="img/icons/funnel${"machine"===e?"-white":""}.svg" />\n                </div>\n                <div class="step-subtitle">Set your spreader</div>\n            </button>\n            <button class="step" data-step="concime" onclick="APP.changeContent('set-concime');">\n                <div class="step-number">2</div>\n                <div class="step-title">${LANG.get("step-concime")}</div>\n                <div class="step-img">\n                    <img src="img/icons/flower${"concime"===e?"-white":""}.svg" />\n                </div>\n                <div class="step-subtitle">Set the product</div>\n            </button>\n            <button class="step" data-step="params" onclick="APP.changeContent('set-params');">\n                <div class="step-number">3</div>\n                <div class="step-title">${LANG.get("step-params")}</div>\n                <div class="step-img">\n                    <img src="img/icons/slider${"params"===e?"-white":""}.svg" />\n                </div>\n                <div class="step-subtitle">Set working parameters</div>\n            </button>\n            <button class="step" data-step="result" onclick="APP.changeContent('result');">\n                <div class="step-number">4</div>\n                <div class="step-title">RESULT</div>\n                <div class="step-img">\n                    <img src="img/icons/list-result${"result"===e?"-white":""}.svg" />\n                </div>\n                <div class="step-subtitle">Result</div>\n            </button>\n        </div>`,t.innerHTML=c;let s=t.querySelector(`[data-step=${e}]`);s.classList.add("is-selected");let r=!a.currentConcime||!a.currentMachine,o=t.querySelector("[data-step=params]"),l=t.querySelector("[data-step=result]");if(r?(o.classList.add("is-disabled"),l.classList.add("is-disabled")):(o.classList.remove("is-disabled"),l.classList.remove("is-disabled")),a.currentMachine){let e=t.querySelector("[data-step=machine]");e.classList.add("is-set");let n=t.querySelector("[data-step=machine] .step-subtitle");n.innerHTML=a.getMachine(a.currentMachine).name}if(a.currentConcime){let e=t.querySelector("[data-step=concime]");e.classList.add("is-set");let n=t.querySelector("[data-step=concime] .step-subtitle");n.innerHTML=a.getConcime(a.currentConcime).name}if(a.currentWorkingWidth&&a.currentWorkingSpeed&&a.currentWorkingQuantity){let e=t.querySelector("[data-step=params]");e.classList.add("is-set")}return t.innerHTML},a.initSetMachine=function(e){let n=e.querySelector(".machine-list"),i=a.getMachine(),c="";for(const e of Object.keys(i)){let t=i[e];c+=`<button class="machine" onclick="APP.setMachine('${e}');">\n                <div class="machine-img">\n                    <img src="img/machine/${e}.jpg" alt="${t.name}" />\n                </div>\n                <div class="machine-footer">\n\n                    <div class="machine-info" onclick="event.stopPropagation();APP.showMachine('${e}');">\n                        <img src="img/icons/info-white.svg" />\n                    </div>\n                        <div class="machine-title">\n                            <div>\n                            ${t.name}\n                            <small>${t.subtitle}</small>\n                            </div>\n                        <img src="img/icons/chevron-right-white.svg" />\n                    </div>\n                </div>\n            </button>`}return a.setTitle("Calculate opening",LANG.get("step-description-machine")),n.innerHTML=c,t.innerHTML=a.getStepHtml("machine"),t.append(e),null},a.getMachine=function(e){return e?MACHINE_DATA[e]:MACHINE_DATA},a.setMachine=function(e){e&&(a.currentMachine=e,a.refreshStepList(),a.currentConcime?a.changeContent("set-params"):a.changeContent("set-concime"))},a.initMachine=function(e,n){let i=a.getMachine(n.id),c="machine-desc",s=`<div class="machine-detail">\n            <button class="machine-close" onclick="APP.hideMachine();">\n                <img src="img/icons/close.svg" alt="">\n            </button>\n            <div class="machine-img">\n                <img src="img/machine/${n.id}.jpg" alt="${i.name}" />\n            </div>\n            <div class="machine-title">\n                ${i.name}\n            </div>\n            <div class="machine-subtitle">\n                ${i.subtitle}\n                </div>\n            <div class="machine-desc">${c}</div>\n        </div>`,r=document.createElement("div");return r.classList.add("machine-detail-container","is-visible"),r.innerHTML=s,t.append(r),null},a.showMachine=function(e){let n=a.getMachine(e),i=LANG.get(e),c=`<div class="machine-detail">\n            <div class="machine-title">\n                ${n.name}\n                <small>${n.subtitle}</small>\n\n                <button class="machine-close" onclick="APP.hideMachine();">\n                    <img src="img/icons/close-white.svg" alt="">\n                </button>\n            </div>\n            <div class="machine-scroll">\n                <div class="machine-img">\n                    <img src="img/machine/${e}.jpg" alt="${n.name}" />\n                    <div class="machine-subtitle">\n                        ${i.subtitle}\n                    </div>\n                </div>\n\n                <div class="machine-desc">\n                    <b>${i.shortDescription}</b>\n                    ${i.description}\n                </div>\n            </div>\n        </div>`,s=document.createElement("div");return s.classList.add("machine-detail-container"),s.innerHTML=c,t.append(s),setTimeout(()=>{document.querySelector(".machine-detail-container").classList.add("is-visible")},300),null},a.hideMachine=function(){a.previousTemplate;let e=document.querySelector(".machine-detail-container");e&&(e.classList.remove("is-visible"),setTimeout(()=>{e.remove()},300))},a.initSetConcime=function(e){let n=e.querySelector(".concime-type-list"),i=e.querySelector(".concime-list"),c=a.getConcime(),s='<div class="concime-type-title">Filter by:</div>';for(const e of a.concimeTypeList){let t=UTIL.capitalizeFirstLetter(e);s+=`<button class="concime-type" onclick="APP.setConcimeType(this, '${e}');">\n                <div class="concime-type-img">\n                    <img src="img/concime-type/${e}.jpg" alt="${t}" />\n                </div>\n                ${t}\n            </button>`}n.innerHTML=s,s="";for(const e of Object.keys(c)){let t=c[e];s+=`<button class="concime" data-concime-type="${t.type}" onclick="APP.setConcime('${e}');">\n                <div class="concime-img">\n                    <img src="img/concime/${e}.png" alt="${t.name}" />\n                </div>\n                <div class="concime-footer">\n                    <div class="concime-info" onclick="event.stopPropagation();APP.showConcime('${e}');">\n                        <img src="img/icons/info-white.svg" />\n                    </div>\n                    <div class="concime-title">\n                        <div>${t.name}</div>\n                        <img src="img/icons/chevron-right-white.svg" />\n                    </div>\n                </div>\n            </button>`}return i.innerHTML=s,t.innerHTML=a.getStepHtml("concime"),t.append(e),a.setTitle("Calculate opening",LANG.get("step-description-concime")),null},a.getConcime=function(e){return e?CONCIME_DATA[e]:CONCIME_DATA},a.setConcimeType=function(e,t){let n=document.querySelector(".concime-type.is-selected");if(n&&n.classList.remove("is-selected"),e.classList.add("is-selected"),!t)return;let i=document.querySelectorAll(".concime");for(const e of i)e.getAttribute("data-concime-type")===t?e.removeAttribute("hidden"):e.setAttribute("hidden","")},a.setConcime=function(e){e&&(a.currentConcime=e,a.refreshStepList(),a.changeContent("set-params"),a.currentMachine?a.changeContent("set-params"):a.changeContent("set-machine"))},a.refreshStepList=function(){if(a.currentConcime&&a.currentMachine){let e=document.querySelector(".step[data-step=params]");e.classList.remove("is-disabled")}},a.showConcime=function(e){let n=a.getConcime(e),i=(LANG.get(e),[{category:"Information"},{name:"Family",value:n.category||""},{name:"Country",value:n.country||""},{name:"Form",value:n.producer||""},{name:"Manufacturer",value:n.producer||""},{name:"KG/DM3",value:n.weight||""},{category:"Fractionation"},{name:"",value:""},{name:"",value:""},{category:"Chemical composition"},{name:"",value:n.chemicalComposition_it||""}]),c="";for(const e of i)e.category?c+=`<div class="property-category">${e.category}</div>`:e.value&&(c+=`<div class="property">\n                    <div class="property-name">${e.name}</div>\n                    <div class="property-line"></div>\n                    <div class="property-value">${e.value}</div>\n                </div>`);let s=`<div class="concime-detail">\n            <div class="concime-title">\n                <small>${n.type}</small>\n\n                <button class="concime-close" onclick="APP.hideConcime();">\n                    <img src="img/icons/close-white.svg" alt="">\n                </button>\n            </div>\n            <div class="concime-scroll">\n                <div class="concime-img">\n                    <img src="img/concime/${e}.png" alt="${n.name}" />\n                    <div class="concime-subtitle">\n                        ${n.name}\n                    </div>\n                </div>\n\n                <div class="property-list">\n                    ${c}\n                </div>\n            </div>\n        </div>`,r=document.createElement("div");return r.classList.add("concime-detail-container"),r.innerHTML=s,t.append(r),setTimeout(()=>{document.querySelector(".concime-detail-container").classList.add("is-visible")},300),null},a.hideConcime=function(){a.previousTemplate;let e=document.querySelector(".concime-detail-container");e&&(e.classList.remove("is-visible"),setTimeout(()=>{e.remove()},300))},a.initSetWorkingParameters=function(e){a.currentMachine||a.changeContent("set-machine"),a.currentConcime||a.changeContent("set-concime");let n=a.getMachine(a.currentMachine),i="";n.widthOpt&&(i=`<div class="optional-width">\n                <input class="optional-width-checkbox switch" id="optionalWidth" name="optionalWidth" type="checkbox" onchange="APP.refreshMaxWorkingWidth();">\n                <label class="optional-width-label" for="optionalWidth">${LANG.get("working-optional-kit")}</label>\n            </div>`);let c={width:{min:n.widthMin,max:a.getMaxWidth(a.currentMachine,a.currentConcime),unit:"m",current:a.currentWorkingWidth},speed:{min:6,max:20,unit:"km/h",current:a.currentWorkingSpeed},quantity:{min:3,max:1e3,unit:"kg/ha",current:a.currentWorkingQuantity}},s=e.querySelector(".parameter-list"),r="";for(const e of Object.keys(c)){let t=c[e],n=t.current||t.min;r+=`<div class="parameter parameter-${e}">\n                <div class="parameter-title">${UTIL.capitalizeFirstLetter(e)}</div>\n                ${"width"===e?i:""}\n                <div class="parameter-input">\n                    <div class="parameter-text">\n                        <input id="widthText" type="text" value="${n}">\n                    </div>\n                    <div class="parameter-slider">\n                        <div class="parameter-max">${t.max} ${t.unit}</div>\n                        <div class="parameter-min">${t.min} ${t.unit}</div>\n                        <input id="widthRange" type="range" step="1" max="${t.max}" min="${t.min}" value="${n}" oninput="APP.refreshCheckLabel(this);">\n                    </div>\n                </div>\n\n\n            </div>`}return s.innerHTML=r,t.innerHTML=a.getStepHtml("params"),e.innerHTML=r,t.append(e),a.setTitle("Calculate opening",LANG.get("step-description-params")),null},a.refreshCheckLabel=function(e){let t=e.closest(".parameter").querySelector(".parameter-text input");console.log(e.value),t.value=e.value},a.refreshMaxWorkingWidth=function(){a.getMachine(a.currentMachine);let e=document.querySelector(".optional-width-checkbox"),t=document.querySelector(".parameter-width .parameter-max"),n=document.querySelector(".parameter-width .parameter-slider input"),i=a.getMaxWidth(a.currentMachine,a.currentConcime,e.checked);t.innerHTML=i+"m",n.setAttribute("max",i),a.refreshCheckLabel(n)},a.paramsReset=function(){},a.paramsCompute=function(){a.currentWorkingWidth=document.querySelector(".parameter-width .parameter-slider input").value,a.currentWorkingSpeed=document.querySelector(".parameter-speed .parameter-slider input").value,a.currentWorkingQuantity=document.querySelector(".parameter-quantity .parameter-slider input").value,a.changeContent("result")},a.getMaxWidth=function(e,t,n=!1){let i=a.getMachine(e),c=a.getConcime(t),s=Math.min(i.widthMax,c.spreadingLimit),r=n?i.widthOptException:i.widthException;return r&&t in r&&(s=Math.min(s,r[t])),s},a.getOpening=function(e,t){const n=0,i=1;a.getMachine(e),a.getConcime(t);let c=a.currentWorkingQuantity*a.currentWorkingWidth*a.currentWorkingSpeed/600;c=UTIL.round(c);let s=null,r=CURVE_DATA[t],o=Number.MAX_VALUE,l=null;for(let e=0;e<r.length&&(l=Math.abs(r[e][i]-c),l<o);e++)o=l,s=r[e][n];return{opening:s,kgMin:c}},a.initResult=function(e){function n(e,t,n=!1){let i="opening"===e.toLowerCase(),c="";return c+=n?`<div class="property-category">${e}</div>`:`<div class="property ${i?"is-important":""}">\n                    <div class="property-name">${e}</div>\n                    <div class="property-line"></div>\n                    <div class="property-value">${t}</div>\n                </div>`,c}a.currentMachine||a.changeContent("set-machine"),a.currentConcime||a.changeContent("set-concime");let i=a.getMachine(a.currentMachine),c=a.getConcime(a.currentConcime),s=e.querySelector(".result-list"),r="",o=a.getOpening(a.currentMachine,a.currentConcime);return r+=n("Result",i.name,!0),r+=n("Opening",o.opening),r+=n("Kg/min",o.kgMin),r+=n("Spreader",i.name,!0),r+=n("Spreader",i.name),r+=n("Discs height",""),r+=n("Pto speed",""),r+=n("Concime",i.name,!0),r+=n("Family",c.type),r+=n("Product",c.name),r+=n("Form",c.shape),r+=n("Weight",c.weight),r+=n("Working parameters",i.name,!0),r+=n("Working width",a.currentWorkingWidth),r+=n("Speed",a.currentWorkingSpeed),r+=n("Quantity",a.currentWorkingQuantity),s.innerHTML='<div class="property-list">'+r+"</div>",t.innerHTML=a.getStepHtml("result"),t.append(e),null},a.saveResult=function(){},a.getResultList=function(){},a.getFlowStepHtml=function(e){let t="",n="is-selected",i=!a.currentConcime||!a.currentMachine;return t=`<div class="step-list">\n            <button class="step ${"machine"===e?n:""}" data-step="machine" onclick="APP.changeContent('set-machine');">\n                <div class="step-number">1</div>\n                <div class="step-title">${LANG.get("step-machine")}</div>\n                <div class="step-subtitle">Set your spreader</div>\n            </button>\n            <button class="step ${i?"is-disabled":""} ${"params"===e?n:""}" data-step="params" onclick="APP.changeContent('set-params');">\n                <div class="step-number">2</div>\n                <div class="step-title">${LANG.get("step-params")}</div>\n                <div class="step-subtitle">Set parameters</div>\n            </button>\n            <button class="step ${i?"is-disabled":""} ${"result"===e?n:""}" data-step="result" onclick="APP.changeContent('result');">\n                <div class="step-number">3</div>\n                <div class="step-title">RESULT</div>\n                <div class="step-subtitle"> </div>\n            </button>\n        </div>`,t},a.initFlowFactor=function(e){return t.innerHTML=a.getFlowStepHtml("machine"),t.append(e),null},a}();document.addEventListener("DOMContentLoaded",function(){LANG.init()});