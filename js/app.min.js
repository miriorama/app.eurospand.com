"use strict";var UTIL=function(){let e={capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},round:function(e){return Math.round(100*(e+Number.EPSILON))/100}};return e}(),LANG=function(){let e={data:null,_current:null,keys:["es","bu","de","en","fr","gr","hu","it","nl","pt","ro","ru","tr"],init:function(t){let n={lang:"en"};t=Object.assign({},n,t);let i="/lang/"+t.lang+".js",c=document.createElement("script");c.onload=function(){e.data=LANG_DATA,APP.init()},c.src=i,document.head.appendChild(c),e._current=t.lang},current:function(){return e._current},get:function(t){return e.data[t]}};return e}(),API=function(){let e={};return e=function(e,t){function n(e){return new Promise(t=>e.json().then(n=>t({status:e.status,ok:e.ok,json:n})))}let i,c=!1;if(t instanceof FormData)i=t;else{c=!0;let e={};t=Object.assign({},e,t),i=JSON.stringify(t)}let r={method:"post",body:i};return c&&(r.headers={"content-type":"application/json"}),new Promise((t,i)=>{fetch(e,r).then(e=>(e.redirected&&(location.href=e.url),e)).then(n).then(e=>e.ok?t(e.json.content):i(e.json)).catch(e=>i({networkError:e.message}))})},e}(),APP=function(){let e,t,n={debug:!0,currentMachine:null,currentConcime:null,concimeTypeList:["fertilizzanti","semi","lumachicida"]};return n.init=function(){e=document.querySelector(".main"),t=document.querySelector(".menu"),n.debug&&(n.currentMachine="david-compact",n.currentConcime="mesurol-pro",n.currentWorkingWidth=9,n.currentWorkingSpeed=6,n.currentWorkingQuantity=1),n.routes=[{regex:"^$",template:"index",callback:n.initIndex},{regex:"^set-machine/?$",template:"set-machine",callback:n.initSetMachine},{regex:"^set-concime/?$",template:"set-concime",callback:n.initSetConcime},{regex:"^set-params/?$",template:"set-params",callback:n.initSetWorkingParameters},{regex:"^result/?$",template:"result",callback:n.initResult}],window.addEventListener("hashchange",APP.onHashChange,!1),APP.onHashChange(),n.initMenu()},n.onHashChange=function(){n.hash=location.hash.substring(1);let t=!0;for(const c of n.routes){let r=new RegExp(c.regex,"i"),a=n.hash.match(r);if(a){let r=a.groups,s=document.querySelector(`template[data-section=${c.template}]`);if(s){n.currentTemplate&&(n.previousTemplate=n.currentTemplate),n.currentTemplate=c.template;let a=s.content.cloneNode(!0);function i(){function n(){document.body.classList.add("animate")}let i=null;i="function"==typeof c.callback?c.callback(a,r):a,i&&(e.innerHTML="",e.append(i)),e.setAttribute("data-section",c.template),t?window.setTimeout(function(){n()},300):n()}t&&(document.body.classList.remove("animate"),n.previousTemplate?setTimeout(function(){i()},300):i())}break}}},n.changeContent=function(e){location.hash=e},n.initIndex=function(t){return console.log("test"),e.innerHTML="",e.append(t),null},n.initMenu=function(){let e=t.querySelector(".menu-saved"),n=t.querySelector(".menu-lang"),i=t.querySelector(".menu-unit"),c=t.querySelector(".menu-who"),r=t.querySelector(".menu-contact");e.innerHTML=LANG.get("menu-saved"),n.innerHTML=LANG.get("menu-lang"),i.innerHTML=LANG.get("menu-unit"),c.innerHTML=LANG.get("menu-who"),r.innerHTML=LANG.get("menu-contact")},n.menuOpen=function(){t.classList.add("is-visible")},n.menuClose=function(){t.classList.remove("is-visible")},n.initSetMachine=function(t){let i=t.querySelector(".machine-list"),c=n.getMachine(),r="";for(const e of Object.keys(c)){let t=c[e];r+=`<button class="machine" onclick="APP.setMachine('${e}');">\n                <div class="machine-img">\n                    <img src="/img/machine/${e}.jpg" alt="${t.name}" />\n                </div>\n                <div class="machine-title">${t.name}</div>\n                <div class="machine-cta">\n                    <div class="btn">${LANG.get("select")}</div>\n                </div>\n            </button>`}return i.innerHTML=r,e.innerHTML=n.getStepHtml("machine"),e.append(t),null},n.getMachine=function(e){return e?MACHINE_DATA[e]:MACHINE_DATA},n.setMachine=function(e){e&&(n.currentMachine=e,n.refreshStepList(),n.changeContent("set-concime"))},n.getStepHtml=function(e){let t="",i="is-selected",c=!n.currentConcime||!n.currentMachine;return t=`<div class="step-list">\n            <button class="step ${"machine"===e?i:""}" data-step="machine" onclick="APP.changeContent('set-machine');">\n                <div class="step-number">1</div>\n                <div class="step-title">${LANG.get("step-machine")}</div>\n                <div class="step-subtitle">Set your spreader</div>\n            </button>\n            <button class="step ${"concime"===e?i:""}" data-step="concime" onclick="APP.changeContent('set-concime');">\n                <div class="step-number">2</div>\n                <div class="step-title">${LANG.get("step-concime")}</div>\n                <div class="step-subtitle">Set the product</div>\n            </button>\n            <button class="step ${c?"is-disabled":""} ${"params"===e?i:""}" data-step="params" onclick="APP.changeContent('set-params');">\n                <div class="step-number">3</div>\n                <div class="step-title">${LANG.get("step-params")}</div>\n                <div class="step-subtitle">Set working parameters</div>\n            </button>\n            <button class="step ${c?"is-disabled":""} ${"result"===e?i:""}" data-step="result" onclick="APP.changeContent('result');">\n                <div class="step-number">4</div>\n                <div class="step-title">RESULT</div>\n                <div class="step-subtitle"> </div>\n            </button>\n        </div>`,t},n.showMachine=function(e){n.getMachine(e);let t=`<div class="machine">\n            <div class="machine-img">${machineImg}</div>\n            <div class="machine-title">${machineTitle}</div>\n            <div class="machine-subtitle">${machineSubtitle}</div>\n            <div class="machine-desc">${machineDesc}</div>\n        </div>`,i=document.createElement("div");i.innerHTML=t,document.body.appendChild(i),document.body.classList.add("alert-overflow")},n.initSetConcime=function(t){let i=t.querySelector(".concime-type-list"),c=t.querySelector(".concime-list"),r=n.getConcime(),a="";for(const e of n.concimeTypeList){let t=UTIL.capitalizeFirstLetter(e);a+=`<button class="concime-type" onclick="APP.setConcimeType(this, '${e}');">\n                <div class="concime-type-img">\n                    <img src="/img/concime-type/${e}.jpg" alt="${t}" />\n                </div>\n                ${t}\n            </button>`}i.innerHTML=a,a="";for(const e of Object.keys(r)){let t=r[e];a+=`<div class="concime" data-concime-type="${t.type}" onclick="APP.setConcime('${e}');">\n                <div class="concime-img">\n                    <img src="/img/concime/${e}.png" alt="${t.name}" />\n                </div>\n                <div class="concime-title">${t.name}</div>\n                <div class="concime-cta">\n                    <button class="btn" >${LANG.get("select")}</button>\n                </div>\n            </div>`}return c.innerHTML=a,e.innerHTML=n.getStepHtml("concime"),e.append(t),null},n.getConcime=function(e){return e?CONCIME_DATA[e]:CONCIME_DATA},n.setConcimeType=function(e,t){let n=document.querySelector(".concime-type.is-selected");if(n&&n.classList.remove("is-selected"),e.classList.add("is-selected"),!t)return;let i=document.querySelectorAll(".concime");for(const e of i)e.getAttribute("data-concime-type")===t?e.removeAttribute("hidden"):e.setAttribute("hidden","")},n.setConcime=function(e){e&&(n.currentConcime=e,n.refreshStepList(),n.changeContent("set-params"))},n.refreshStepList=function(){if(n.currentConcime&&n.currentMachine){let e=document.querySelector(".step[data-step=params]");e.classList.remove("is-disabled")}},n.initSetWorkingParameters=function(t){let i=n.getMachine(n.currentMachine),c="";i.widthOpt&&(c=`<div class="optional-width">\n                <input class="optional-width-checkbox switch" id="optionalWidth" name="optionalWidth" type="checkbox" onchange="APP.refreshMaxWorkingWidth();">\n                <label class="optional-width-label" for="optionalWidth">${LANG.get("working-optional-kit")}</label>\n            </div>`);let r={width:{min:i.widthMin,max:n.getMaxWidth(n.currentMachine,n.currentConcime)},speed:{min:6,max:20},quantity:{min:3,max:1e3}},a=t.querySelector(".parameter-list"),s="";for(const e of Object.keys(r)){let t=r[e];s+=`<div class="parameter parameter-${e}">\n                <div class="parameter-title">${UTIL.capitalizeFirstLetter(e)}</div>\n                ${"width"===e?c:""}\n                <div class="parameter-input">\n                    <div class="parameter-text">\n                        <input id="widthText" type="text" value="${t.min}">\n                    </div>\n                    <div class="parameter-slider">\n                        <div class="parameter-max">${t.max}m</div>\n                        <div class="parameter-min">${t.min}m</div>\n                        <input id="widthRange" type="range" step="1" max="${t.max}" min="${t.min}" value="${t.min}" oninput="APP.refreshCheckLabel(this);">\n                    </div>\n                </div>\n\n\n            </div>`}return a.innerHTML=s,e.innerHTML=n.getStepHtml("params"),t.innerHTML=s,e.append(t),null},n.refreshCheckLabel=function(e){let t=e.closest(".parameter").querySelector(".parameter-text input");console.log(e.value),t.value=e.value},n.refreshMaxWorkingWidth=function(){n.getMachine(n.currentMachine);let e=document.querySelector(".optional-width-checkbox"),t=document.querySelector(".parameter-width .parameter-max"),i=document.querySelector(".parameter-width .parameter-slider input"),c=n.getMaxWidth(n.currentMachine,n.currentConcime,e.checked);t.innerHTML=c+"m",i.setAttribute("max",c),n.refreshCheckLabel(i)},n.paramsReset=function(){},n.paramsCompute=function(){n.currentWorkingWidth=document.querySelector(".parameter-width .parameter-slider input").value,n.currentWorkingSpeed=document.querySelector(".parameter-speed .parameter-slider input").value,n.currentWorkingQuantity=document.querySelector(".parameter-quantity .parameter-slider input").value,n.changeContent("result")},n.getMaxWidth=function(e,t,i=!1){let c=n.getMachine(e),r=n.getConcime(t),a=Math.min(c.widthMax,r.spreadingLimit),s=i?c.widthOptException:c.widthException;return s&&t in s&&(a=Math.min(a,s[t])),a},n.getOpening=function(e,t){const i=0,c=1;n.getMachine(e),n.getConcime(t);let r=n.currentWorkingQuantity*n.currentWorkingWidth*n.currentWorkingSpeed/600;r=UTIL.round(r);let a=null,s=CURVE_DATA[t],o=Number.MAX_VALUE,l=null;for(let e=0;e<s.length&&(l=Math.abs(s[e][c]-r),l<o);e++)o=l,a=s[e][i];return{opening:a,kgMin:r}},n.initResult=function(t){function i(e,t){let n=`<div class="result">\n                <div class="result-text">${e}</div>\n                <div class="result-line"></div>\n                <div class="result-value">${t}</div>\n            </div>`;return n}let c=n.getMachine(n.currentMachine),r=n.getConcime(n.currentConcime),a=t.querySelector(".result-list"),s="",o=n.getOpening(n.currentMachine,n.currentConcime);return s+=i("openening",o.opening),s+=i("kg/min",o.kgMin),s+='<div class="result-separator"></div>',s+=i("spreader",c.name),s+=i("discs height",""),s+=i("pto speed",""),s+='<div class="result-separator"></div>',s+=i("family",r.type),s+=i("product",r.name),s+=i("form",r.shape),s+=i("weight",r.weight),s+='<div class="result-separator"></div>',s+=i("working width",n.currentWorkingWidth),s+=i("speed",n.currentWorkingSpeed),s+=i("quantity",n.currentWorkingQuantity),a.innerHTML=s,e.innerHTML=n.getStepHtml("result"),e.append(t),null},n.saveResult=function(){},n.getResultList=function(){},n}();document.addEventListener("DOMContentLoaded",function(){LANG.init()});